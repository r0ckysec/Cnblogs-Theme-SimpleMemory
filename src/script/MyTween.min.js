function openComplete(a){a.opened=!0,a.opening=!1,a.closing=!1}function closeComplete(a){a.opened=!1,a.opening=!1,a.closing=!1}function unselectTris(){for(var a=0;a<tris.length;a++)tris[a].selectedForTrail=!1}function createTrail(){var a,b,c,d,e,f;if(unselectTris(),b=Math.floor(Math.random()*trailMaxLength-2)+2,c=Math.round(Math.random()*tris.length),startTri=tris[c],"undefined"==typeof startTri||"undefined"==typeof startTri.selectedForTrail)return!1;for(startTri.selectedForTrail=!0,a={tri:startTri,openDir:"side",closeDir:"side"},d=0;b>d;d++){if(e=getNeighbour(a.tri),null==e){a.tri.open(a.openDir,speedTriOpen,f,(d+1)*speedTrailAppear),a.tri.close(a.closeDir,1,delayBeforeDisappear+(d+1)*speedTrailDisappear);break}e.tri.selectedForTrail=!0,f=randomAlpha?Math.random()<.8?.5*Math.random():1:1,a.tri.closeDir=e.openDir,a.tri.open(a.openDir,speedTriOpen,f,d*speedTrailAppear),a.tri.close(a.closeDir,1,delayBeforeDisappear+d*speedTrailDisappear),a=e}}function getNeighbour(a){shuffleArray(neighbours);for(var b=0;b<neighbours.length;b++)if("top"==neighbours[b]){if(0!=a.row&&!tris[a.pos-cols].selectedForTrail&&!tris[a.pos-cols].opened)return{tri:tris[a.pos-cols],openDir:"top",closeDir:"top"}}else if("bottom"==neighbours[b]){if(a.row!=rows-1&&!tris[a.pos+cols].selectedForTrail&&!tris[a.pos+cols].opened)return{tri:tris[a.pos+cols],openDir:"bottom",closeDir:"top"}}else{if(a.isLeft&&a.col!=cols-1&&!tris[a.pos+1].selectedForTrail&&!tris[a.pos+1].opened)return{tri:tris[a.pos+1],openDir:"side",closeDir:"top"};if(!a.isLeft&&0!=a.col&&!tris[a.pos-1].selectedForTrail&&!tris[a.pos-1].opened)return{tri:tris[a.pos-1],openDir:"side",closeDir:"top"}}return null}function draw(){c.clearRect(0,0,C.width,C.height);for(var a=0;a<tris.length;a++)tris[a].draw()}function handleResize(){viewWidth=C.width=C.scrollWidth,viewHeight=C.height=C.scrollHeight,rectCanvas=C.getBoundingClientRect(),start()}function hexToRgb(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null}function shuffleArray(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}function initCanvas(a){C=document.getElementById(a),c=C.getContext("2d"),viewWidth=C.width=C.scrollWidth,viewHeight=C.height=C.scrollHeight,initParams(),window.addEventListener("resize",handleResize),TweenLite.ticker.addEventListener("tick",draw),handleResize()}function initParams(){cols=Math.floor(viewWidth/triW),cols=cols%2?cols:cols-1,rows=2*Math.floor(viewHeight/triH),tris=[]}function initGrid(){var a,b,c,d;for(a=0;rows>a;a++)for(b=0;cols>b;b++)c=b+a*cols,d=new Triangle(c,b,a),tris.push(d),d.draw()}function start(){interval&&clearInterval(interval),initParams(),initGrid(),interval=setInterval(createTrail,trailIntervalCreation),createTrail()}function pause(){interval&&clearInterval(interval);for(var a=0;a<tris.length;a++)tris[a].tweenClose&&tris[a].tweenClose.kill()}function closeAll(){var b,a=0;for(interval&&clearInterval(interval),b=0;b<tris.length;b++)tris[b].tweenOpen&&tris[b].tweenOpen.kill(),(tris[b].opened||tris[b].opening)&&(a++,tris[b].close("top",.8,.2+.0015*a))}function kill(){interval&&clearInterval(interval);for(var a=0;a<tris.length;a++)TweenLite.killTweensOf(tris[a]),tris[a].alpha=0}var C,c,viewWidth,viewHeight,cols,rows,tris,interval,mouseX=mouseY=mouseOldX=mouseOldY=0,triW=window.cnblogsConfig.essayTopAnimation.triW,triH=window.cnblogsConfig.essayTopAnimation.triH,neighbours=window.cnblogsConfig.essayTopAnimation.neighbours,speedTrailAppear=window.cnblogsConfig.essayTopAnimation.speedTrailAppear,speedTrailDisappear=window.cnblogsConfig.essayTopAnimation.speedTrailDisappear,speedTriOpen=window.cnblogsConfig.essayTopAnimation.speedTriOpen,trailMaxLength=window.cnblogsConfig.essayTopAnimation.trailMaxLength,trailIntervalCreation=window.cnblogsConfig.essayTopAnimation.trailIntervalCreation,delayBeforeDisappear=window.cnblogsConfig.essayTopAnimation.delayBeforeDisappear,randomAlpha=!0,colors=window.cnblogsConfig.essayTopAnimation.colors;Triangle=function(a,b,d){var e=this;this.selectedForTrail=!1,this.pos=a,this.col=b,this.row=d,this.alpha=this.tAlpha=1,this.color=colors[Math.floor(Math.random()*colors.length)],this.rgb=hexToRgb(this.color),this.opened=!1,this.opening=!1,this.closing=!1,this.isLeft=this.pos%2,this.tX1=this.isLeft?(this.col+1)*triW:this.col*triW,this.tX2=this.isLeft?this.col*triW:(this.col+1)*triW,this.tX3=this.isLeft?(this.col+1)*triW:this.col*triW,this.x1=this.tX1,this.x2=this.tX1,this.x3=this.tX1,this.tY1=.5*this.row*triH,this.tY2=.5*(this.row+1)*triH,this.tY3=.5*(this.row+2)*triH,this.y1=this.tY1,this.y2=this.tY1,this.y3=this.tY1,this.tweenClose,this.tweenOpen,this.draw=function(){c.fillStyle="rgba("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+","+this.alpha+")",c.beginPath(),c.moveTo(this.x1,this.y1),c.lineTo(this.x2,this.y2),c.lineTo(this.x3,this.y3),c.closePath(),c.fill()},this.open=function(a,b,c,d){this.opened&&this.opening||(this.tweenClose&&this.tweenClose.kill(),this.opening=!0,this.direction=a||"top",this.delay=d||0,this.tAlpha=c,this.tSpeed=b||1.5,"side"==this.direction?(this.x1=this.x2=this.x3=this.tX1,this.y1=this.tY1,this.y2=this.tY2,this.y3=this.tY3):"top"==this.direction?(this.x1=(this.tX2+this.tX3)/2,this.x2=this.tX2,this.x3=this.tX3,this.y1=(this.tY2+this.tY3)/2,this.y2=this.tY2,this.y3=this.tY3):"bottom"==this.direction&&(this.x1=this.tX1,this.x2=this.tX2,this.x3=(this.tX1+this.tX2)/2,this.y1=this.tY1,this.y2=this.tY2,this.y3=(this.tY1+this.tY2)/2),this.tweenOpen=TweenMax.to(this,this.tSpeed,{x1:this.tX1,x2:this.tX2,x3:this.tX3,y1:this.tY1,y2:this.tY2,y3:this.tY3,alpha:this.tAlpha,ease:Strong.easeInOut,delay:this.delay,onComplete:openComplete,onCompleteParams:[e]}))},this.close=function(a,b,c){this.direction=a||"top",this.delay=c||1,this.tSpeed=b||.8,this.opened=!1,this.closing=!0;var d,f,g,h,i,j;"side"==this.direction?(d=f=g=this.tX1,h=this.tY1,i=this.tY2,j=this.tY3):"top"==this.direction?(d=(this.tX2+this.tX3)/2,f=this.tX2,g=this.tX3,h=(this.tY2+this.tY3)/2,i=this.tY2,j=this.tY3):"bottom"==this.direction&&(d=this.tX1,f=this.tX2,g=(this.tX1+this.tX2)/2,h=this.tY1,i=this.tY2,j=(this.tY1+this.tY2)/2),this.tweenClose&&this.tweenClose.kill(),this.tweenClose=TweenMax.to(this,this.tSpeed,{x1:d,x2:f,x3:g,y1:h,y2:i,y3:j,alpha:0,ease:Strong.easeInOut,delay:this.delay,onComplete:closeComplete,onCompleteParams:[e]})}};