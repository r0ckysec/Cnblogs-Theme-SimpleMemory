"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass,Polygon,Spinner,pageLoading;!function(){function n(a,b){var c=a.indexOf(b);-1!=c&&a.splice(c,1)}var e,f,g,h,i,j,k,l,m,o,a={},b=a.util={},c=Array.prototype.concat,d=Array.prototype.slice;b.bind=function(a,b){var e=d.call(arguments,2);return function(){a.apply(b,c.call(e,d.call(arguments)))}},b.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},e=a.SpringSystem=function(a){this._springRegistry={},this._activeSprings=[],this.listeners=[],this._idleSpringIndices=[],this.looper=a||new i,this.looper.springSystem=this},b.extend(e.prototype,{_springRegistry:null,_isIdle:!0,_lastTimeMillis:-1,_activeSprings:null,listeners:null,_idleSpringIndices:null,setLooper:function(a){this.looper=a,a.springSystem=this},createSpring:function(a,b){var c;return c=void 0===a||void 0===b?h.DEFAULT_ORIGAMI_SPRING_CONFIG:h.fromOrigamiTensionAndFriction(a,b),this.createSpringWithConfig(c)},createSpringWithBouncinessAndSpeed:function(a,b){var c;return c=void 0===a||void 0===b?h.DEFAULT_ORIGAMI_SPRING_CONFIG:h.fromBouncinessAndSpeed(a,b),this.createSpringWithConfig(c)},createSpringWithConfig:function(a){var b=new f(this);return this.registerSpring(b),b.setSpringConfig(a),b},getIsIdle:function(){return this._isIdle},getSpringById:function(a){return this._springRegistry[a]},getAllSprings:function(){var b,a=[];for(b in this._springRegistry)this._springRegistry.hasOwnProperty(b)&&a.push(this._springRegistry[b]);return a},registerSpring:function(a){this._springRegistry[a.getId()]=a},deregisterSpring:function(a){n(this._activeSprings,a),delete this._springRegistry[a.getId()]},advance:function(a,b){for(var c,d,e,f;this._idleSpringIndices.length>0;)this._idleSpringIndices.pop();for(c=0,d=this._activeSprings.length;d>c;c++)e=this._activeSprings[c],e.systemShouldAdvance()?e.advance(a/1e3,b/1e3):this._idleSpringIndices.push(this._activeSprings.indexOf(e));for(;this._idleSpringIndices.length>0;)f=this._idleSpringIndices.pop(),f>=0&&this._activeSprings.splice(f,1)},loop:function(a){var b,c,d,e;for(-1===this._lastTimeMillis&&(this._lastTimeMillis=a-1),c=a-this._lastTimeMillis,this._lastTimeMillis=a,d=0,e=this.listeners.length,d=0;e>d;d++)b=this.listeners[d],b.onBeforeIntegrate&&b.onBeforeIntegrate(this);for(this.advance(a,c),0===this._activeSprings.length&&(this._isIdle=!0,this._lastTimeMillis=-1),d=0;e>d;d++)b=this.listeners[d],b.onAfterIntegrate&&b.onAfterIntegrate(this);this._isIdle||this.looper.run()},activateSpring:function(a){var b=this._springRegistry[a];-1==this._activeSprings.indexOf(b)&&this._activeSprings.push(b),this.getIsIdle()&&(this._isIdle=!1,this.looper.run())},addListener:function(a){this.listeners.push(a)},removeListener:function(a){n(this.listeners,a)},removeAllListeners:function(){this.listeners=[]}}),f=a.Spring=function H(a){this._id="s"+H._ID++,this._springSystem=a,this.listeners=[],this._currentState=new g,this._previousState=new g,this._tempState=new g},b.extend(f,{_ID:0,MAX_DELTA_TIME_SEC:.064,SOLVER_TIMESTEP_SEC:.001}),b.extend(f.prototype,{_id:0,_springConfig:null,_overshootClampingEnabled:!1,_currentState:null,_previousState:null,_tempState:null,_startValue:0,_endValue:0,_wasAtRest:!0,_restSpeedThreshold:.001,_displacementFromRestThreshold:.001,listeners:null,_timeAccumulator:0,_springSystem:null,destroy:function(){this.listeners=[],this.frames=[],this._springSystem.deregisterSpring(this)},getId:function(){return this._id},setSpringConfig:function(a){return this._springConfig=a,this},getSpringConfig:function(){return this._springConfig},setCurrentValue:function(a,b){return this._startValue=a,this._currentState.position=a,b||this.setAtRest(),this.notifyPositionUpdated(!1,!1),this},getStartValue:function(){return this._startValue},getCurrentValue:function(){return this._currentState.position},getCurrentDisplacementDistance:function(){return this.getDisplacementDistanceForState(this._currentState)},getDisplacementDistanceForState:function(a){return Math.abs(this._endValue-a.position)},setEndValue:function(a){var b,c,d,e;if(this._endValue==a&&this.isAtRest())return this;for(this._startValue=this.getCurrentValue(),this._endValue=a,this._springSystem.activateSpring(this.getId()),b=0,c=this.listeners.length;c>b;b++)d=this.listeners[b],e=d.onSpringEndStateChange,e&&e(this);return this},getEndValue:function(){return this._endValue},setVelocity:function(a){return a===this._currentState.velocity?this:(this._currentState.velocity=a,this._springSystem.activateSpring(this.getId()),this)},getVelocity:function(){return this._currentState.velocity},setRestSpeedThreshold:function(a){return this._restSpeedThreshold=a,this},getRestSpeedThreshold:function(){return this._restSpeedThreshold},setRestDisplacementThreshold:function(a){this._displacementFromRestThreshold=a},getRestDisplacementThreshold:function(){return this._displacementFromRestThreshold},setOvershootClampingEnabled:function(a){return this._overshootClampingEnabled=a,this},isOvershootClampingEnabled:function(){return this._overshootClampingEnabled},isOvershooting:function(){var a=this._startValue,b=this._endValue;return this._springConfig.tension>0&&(b>a&&this.getCurrentValue()>b||a>b&&this.getCurrentValue()<b)},advance:function(a,b){var d,l,m,n,o,p,q,r,s,t,u,e,g,h,i,j,k,v,w,c=this.isAtRest();if(!c||!this._wasAtRest){for(d=b,b>f.MAX_DELTA_TIME_SEC&&(d=f.MAX_DELTA_TIME_SEC),this._timeAccumulator+=d,e=this._springConfig.tension,g=this._springConfig.friction,h=this._currentState.position,i=this._currentState.velocity,j=this._tempState.position,k=this._tempState.velocity;this._timeAccumulator>=f.SOLVER_TIMESTEP_SEC;)this._timeAccumulator-=f.SOLVER_TIMESTEP_SEC,this._timeAccumulator<f.SOLVER_TIMESTEP_SEC&&(this._previousState.position=h,this._previousState.velocity=i),l=i,m=e*(this._endValue-j)-g*i,j=h+.5*l*f.SOLVER_TIMESTEP_SEC,k=i+.5*m*f.SOLVER_TIMESTEP_SEC,n=k,o=e*(this._endValue-j)-g*k,j=h+.5*n*f.SOLVER_TIMESTEP_SEC,k=i+.5*o*f.SOLVER_TIMESTEP_SEC,p=k,q=e*(this._endValue-j)-g*k,j=h+.5*p*f.SOLVER_TIMESTEP_SEC,k=i+.5*q*f.SOLVER_TIMESTEP_SEC,r=k,s=e*(this._endValue-j)-g*k,t=1/6*(l+2*(n+p)+r),u=1/6*(m+2*(o+q)+s),h+=t*f.SOLVER_TIMESTEP_SEC,i+=u*f.SOLVER_TIMESTEP_SEC;this._tempState.position=j,this._tempState.velocity=k,this._currentState.position=h,this._currentState.velocity=i,this._timeAccumulator>0&&this._interpolate(this._timeAccumulator/f.SOLVER_TIMESTEP_SEC),(this.isAtRest()||this._overshootClampingEnabled&&this.isOvershooting())&&(this._springConfig.tension>0?(this._startValue=this._endValue,this._currentState.position=this._endValue):(this._endValue=this._currentState.position,this._startValue=this._endValue),this.setVelocity(0),c=!0),v=!1,this._wasAtRest&&(this._wasAtRest=!1,v=!0),w=!1,c&&(this._wasAtRest=!0,w=!0),this.notifyPositionUpdated(v,w)}},notifyPositionUpdated:function(a,b){var c,d,e;for(c=0,d=this.listeners.length;d>c;c++)e=this.listeners[c],a&&e.onSpringActivate&&e.onSpringActivate(this),e.onSpringUpdate&&e.onSpringUpdate(this),b&&e.onSpringAtRest&&e.onSpringAtRest(this)},systemShouldAdvance:function(){return!this.isAtRest()||!this.wasAtRest()},wasAtRest:function(){return this._wasAtRest},isAtRest:function(){return Math.abs(this._currentState.velocity)<this._restSpeedThreshold&&(this.getDisplacementDistanceForState(this._currentState)<=this._displacementFromRestThreshold||0===this._springConfig.tension)},setAtRest:function(){return this._endValue=this._currentState.position,this._tempState.position=this._currentState.position,this._currentState.velocity=0,this},_interpolate:function(a){this._currentState.position=this._currentState.position*a+this._previousState.position*(1-a),this._currentState.velocity=this._currentState.velocity*a+this._previousState.velocity*(1-a)},getListeners:function(){return this.listeners},addListener:function(a){return this.listeners.push(a),this},removeListener:function(a){return n(this.listeners,a),this},removeAllListeners:function(){return this.listeners=[],this},currentValueIsApproximately:function(a){return Math.abs(this.getCurrentValue()-a)<=this.getRestDisplacementThreshold()}}),g=function(){},b.extend(g.prototype,{position:0,velocity:0}),h=a.SpringConfig=function(a,b){this.tension=a,this.friction=b},i=a.AnimationLooper=function(){var a,c;this.springSystem=null,a=this,c=function(){a.springSystem.loop(Date.now())},this.run=function(){b.onFrame(c)}},a.SimulationLooper=function(a){var b,c;this.springSystem=null,b=0,c=!1,a=a||16.667,this.run=function(){if(!c){for(c=!0;!this.springSystem.getIsIdle();)this.springSystem.loop(b+=a);c=!1}}},a.SteppingSimulationLooper=function(){this.springSystem=null;var b=0;this.run=function(){},this.step=function(a){this.springSystem.loop(b+=a)}},j=a.OrigamiValueConverter={tensionFromOrigamiValue:function(a){return 3.62*(a-30)+194},origamiValueFromTension:function(a){return(a-194)/3.62+30},frictionFromOrigamiValue:function(a){return 3*(a-8)+25},origamiFromFriction:function(a){return(a-25)/3+8}},k=a.BouncyConversion=function(a,b){var c,d;this.bounciness=a,this.speed=b,c=this.normalize(a/1.7,0,20),c=this.projectNormal(c,0,.8),d=this.normalize(b/1.7,0,20),this.bouncyTension=this.projectNormal(d,.5,200),this.bouncyFriction=this.quadraticOutInterpolation(c,this.b3Nobounce(this.bouncyTension),.01)},b.extend(k.prototype,{normalize:function(a,b,c){return(a-b)/(c-b)},projectNormal:function(a,b,c){return b+a*(c-b)},linearInterpolation:function(a,b,c){return a*c+(1-a)*b},quadraticOutInterpolation:function(a,b,c){return this.linearInterpolation(2*a-a*a,b,c)},b3Friction1:function(a){return 7e-4*Math.pow(a,3)-.031*Math.pow(a,2)+.64*a+1.28},b3Friction2:function(a){return 44e-6*Math.pow(a,3)-.006*Math.pow(a,2)+.36*a+2},b3Friction3:function(a){return 4.5e-7*Math.pow(a,3)-332e-6*Math.pow(a,2)+.1078*a+5.84},b3Nobounce:function(a){var b=0;return b=18>=a?this.b3Friction1(a):a>18&&44>=a?this.b3Friction2(a):this.b3Friction3(a)}}),b.extend(h,{fromOrigamiTensionAndFriction:function(a,b){return new h(j.tensionFromOrigamiValue(a),j.frictionFromOrigamiValue(b))},fromBouncinessAndSpeed:function(b,c){var d=new a.BouncyConversion(b,c);return this.fromOrigamiTensionAndFriction(d.bouncyTension,d.bouncyFriction)},coastingConfigWithOrigamiFriction:function(a){return new h(0,j.frictionFromOrigamiValue(a))}}),h.DEFAULT_ORIGAMI_SPRING_CONFIG=h.fromOrigamiTensionAndFriction(40,7),b.extend(h.prototype,{friction:0,tension:0}),l={},b.hexToRGB=function(a){var b,c;return l[a]?l[a]:(a=a.replace("#",""),3===a.length&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=a.match(/.{2}/g),c={r:parseInt(b[0],16),g:parseInt(b[1],16),b:parseInt(b[2],16)},l[a]=c,c)},b.rgbToHex=function(a,b,c){return a=a.toString(16),b=b.toString(16),c=c.toString(16),a=a.length<2?"0"+a:a,b=b.length<2?"0"+b:b,c=c.length<2?"0"+c:c,"#"+a+b+c},m=a.MathUtil={mapValueInRange:function(a,b,c,d,e){var f=c-b,g=e-d,h=(a-b)/f;return d+h*g},interpolateColor:function(a,c,d,e,f,g){var h,i,j;return e=void 0===e?0:e,f=void 0===f?1:f,c=b.hexToRGB(c),d=b.hexToRGB(d),h=Math.floor(b.mapValueInRange(a,e,f,c.r,d.r)),i=Math.floor(b.mapValueInRange(a,e,f,c.g,d.g)),j=Math.floor(b.mapValueInRange(a,e,f,c.b,d.b)),g?"rgb("+h+","+i+","+j+")":b.rgbToHex(h,i,j)},degreesToRadians:function(a){return a*Math.PI/180},radiansToDegrees:function(a){return 180*a/Math.PI}},b.extend(b,m),"undefined"!=typeof window&&(o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}),o||"undefined"==typeof process||"node"!==process.title||(o=setImmediate),b.onFrame=function(a){return o(a)},"undefined"!=typeof exports?b.extend(exports,a):"undefined"!=typeof window&&(window.rebound=a)}(),_createClass=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Polygon=function(){function a(){var b=arguments.length<=0||void 0===arguments[0]?100:arguments[0],c=arguments.length<=1||void 0===arguments[1]?3:arguments[1],d=arguments.length<=2||void 0===arguments[2]?0:arguments[2],e=arguments[3];_classCallCheck(this,a),this._radius=b,this._sides=c,this._depth=d,this._colors=e,this._x=0,this._y=0,this.rotation=0,this.scale=1,this.points=this._getRegularPolygonPoints()}return _createClass(a,[{key:"_getRegularPolygonPoints",value:function(){for(var c,d,a=[],b=0;b<this._sides;)c=-this._radius*Math.sin(2*b*Math.PI/this._sides),d=this._radius*Math.cos(2*b*Math.PI/this._sides),a.push({x:c,y:d}),b++;return a}},{key:"_getInscribedPoints",value:function(a,b){var c=this,d=[];return a.forEach(function(e,f){var i,g=e,h=a[f+1];h||(h=a[0]),i=c._getInterpolatedPoint(g,h,b),d.push(i)}),d}},{key:"_getInterpolatedPoint",value:function(a,b,c){var d=a.x,e=a.y,f=b.x,g=b.y,h=d+(f-d)*c,i=e+(g-e)*c;return{x:h,y:i}}},{key:"_getUpdatedChildren",value:function(a){var c,d,e,b=[];for(c=0;c<this._depth;c++)d=b[c-1]||this.points,e=this._getInscribedPoints(d,a),b.push(e);return b}},{key:"renderChildren",value:function(a,b){var c=this,d=this._getUpdatedChildren(b);d.forEach(function(b,e){var f,g,h,i,j,k;a.beginPath(),b.forEach(function(b){return a.lineTo(b.x,b.y)}),a.closePath(),f=c._colors.stroke,g=c._colors.child,f&&(a.strokeStyle=f,a.stroke()),g&&(h=rebound.util.hexToRGB(g),i=1/d.length,j=i+i*e,k="rgba("+h.r+", "+h.g+", "+h.b+", "+j+")",a.fillStyle=k,a.shadowColor="rgba(0,0,0, 0.1)",a.shadowBlur=10,a.shadowOffsetX=0,a.shadowOffsetY=0,a.fill())})}},{key:"render",value:function(a){var b,c;a.save(),a.translate(this._x,this._y),0!==this.rotation&&a.rotate(rebound.MathUtil.degreesToRadians(this.rotation)),1!==this.scale&&a.scale(this.scale,this.scale),a.beginPath(),this.points.forEach(function(b){return a.lineTo(b.x,b.y)}),a.closePath(),b=this._colors.stroke,c=this._colors.base,b&&(a.strokeStyle=b,a.stroke()),c&&(a.fillStyle=c,a.fill()),a.restore()}}]),a}(),_createClass=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Spinner=function(){function a(b){_classCallCheck(this,a);var d=(b.id,b.radius),e=b.sides,f=b.depth,g=b.colors,h=b.alwaysForward,i=b.restAt,j=b.renderBase;3>e&&(console.warn("At least 3 sides required."),e=3),this._canvas=document.createElement("canvas"),this._canvas.style.backgroundColor=g.background,this._canvas.style.zIndex=1100,this._canvasW=null,this._canvasH=null,this._canvasOpacity=1,this._centerX=null,this._centerY=null,this._alwaysForward=h,this._restThreshold=i,this._renderBase=j,this._springRangeLow=0,this._springRangeHigh=this._restThreshold||1,this._basePolygon=new Polygon(d,e,f,g),this._progress=0,this._isAutoSpin=null,this._isCompleting=null}return _createClass(a,[{key:"init",value:function(a,b){this._addCanvas(),this._spring=a,this._addSpringListener(),this._isAutoSpin=b,b?this._spin():(this._spring.setEndValue(0),this.render())}},{key:"_addCanvas",value:function(){document.body.appendChild(this._canvas),this._context=this._canvas.getContext("2d"),this._setCanvasSize()}},{key:"_setCanvasSize",value:function(){this._canvasW=this._canvas.width=window.innerWidth,this._canvasH=this._canvas.height=window.innerHeight,this._canvas.style.position="fixed",this._canvas.style.top=0,this._canvas.style.left=0,this._centerX=this._canvasW/2,this._centerY=this._canvasH/2}},{key:"_addSpringListener",value:function(){var a=this;this._spring.addListener({onSpringUpdate:function(b){var c=b.getCurrentValue(),d=0,e=1,f=a._springRangeLow,g=a._springRangeHigh;c=rebound.MathUtil.mapValueInRange(c,d,e,f,g),a.render(c)}})}},{key:"setComplete",value:function(){this._isCompleting=!0}},{key:"_completeAnimation",value:function(){this._canvasOpacity-=.1,this._canvas.style.opacity=this._canvasOpacity,this._canvasOpacity<=0&&(this._isAutoSpin=!1,this._spring.setAtRest(),this._canvas.style.display="none",this._canvas.remove())}},{key:"_spin",value:function(){if(this._alwaysForward){var a=this._spring.getCurrentValue();this._restThreshold&&1===a&&this._switchSpringRange(),1===a&&this._spring.setCurrentValue(0).setAtRest()}this._spring.setEndValue(1===this._spring.getCurrentValue()?0:1)}},{key:"_switchSpringRange",value:function(){var a=this._restThreshold;this._springRangeLow=this._springRangeLow===a?0:a,this._springRangeHigh=this._springRangeHigh===a?1:a}},{key:"render",value:function(a){a&&(this._progress=Math.round(1e4*a)/1e4),this._isAutoSpin&&this._spring.isAtRest()&&this._spin(),this._isCompleting&&this._completeAnimation(),this._context.clearRect(0,0,this._canvasW,this._canvasH),this._context.save(),this._context.translate(this._centerX,this._centerY),this._context.lineWidth=1.5,this._renderBase&&this._basePolygon.render(this._context),this._basePolygon.renderChildren(this._context,this._progress),this._context.restore()}}]),a}(),pageLoading={settings:window.cnblogsConfig.loading,spring:null,spinner:null,initRebound:function(){var a=pageLoading.settings.rebound,b=new rebound.SpringSystem;pageLoading.spring=b.createSpring(a.tension,a.friction)},initSpinner:function(){var a=pageLoading.settings.spinner;pageLoading.spinner=new Spinner(a)},init:function(){var a=!0;pageLoading.initRebound(),pageLoading.initSpinner(),pageLoading.spinner.init(pageLoading.spring,a),a?setTimeout(function(){pageLoading.spinner.setComplete()},6e3):pageLoading.loadSomething()},loadSomething:function(){var a=new XMLHttpRequest;a.addEventListener("progress",function(a){if(a.lengthComputable){var b=Math.ceil(100*(a.loaded/a.total));console.log("ajax loding percent",b),pageLoading.spring.setEndValue(.01*b)}}),a.addEventListener("load",function(){pageLoading.spinner.setComplete()}),a.open("GET","/img/something.jpg"),a.send()}};